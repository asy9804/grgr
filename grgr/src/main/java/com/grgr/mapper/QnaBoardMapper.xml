<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.grgr.mapper.QnaBoardMapper">
	<!-- 게시글 삽입 -->
	<insert id="insertQnaBoard">
		<selectKey resultType="int" keyProperty="qna_bno" order="BEFORE">
			select qna_bno_seq.nextval 
			from dual 
		</selectKey>
		insert into qna_board values(#{qnaBno}, #{uno}, #{qnaKeyword}, #{qnaTitle}
			, #{qnaContent}, #{qnaBlindstate}, SYSDATE, SYSDATE, #{qnaUpdateUno})
	</insert>	
	
	<!-- 게시글 수정 -->
	<update id="updateQnaBoard">
		update qna_board set qna_keyword=#{qnaKeyword}
			, qna_title=#{qnaTitle}, qna_content=#{qnaContent}
				, qna_blindstate=#{qnaBlindstate},qna_modifydate=SYSDATE 
				,qna_update_uno=#{qnaUpdateUno}
		where qna_bno=#{qnaBno} and uno=#{uno}
	</update>
	
	<!-- 게시글 삭제 -->
	<delete id="deleteQnaBoard">
		delete 
		from qna_board=3 
		where qna_bno=#{qnaBno}
	</delete>
	
	<!-- 게시글 검색 -->
	<select id="selectQnaBoard" resultType="QnaBoard">
		select qna_blindstate, qna_title, qna_content from qna_board 
		where qna_blindstate=1 
			and (qna_title like '%'||#{qna_title}||'%' 
				or qna_content like '%'||#{qna_content}||'%') 
	</select>
	
	<!-- 게시글 개수 검색 -->
	<select id="selectQnaBoardCount" resultType="int">
		select count(*) 
		from qna_board
	</select>
	
	<!-- 게시글 목록 검색 -->
	<select id="selectQnaBoardList" resultType="QnaBoard">
		select * 
		from (select ROWNUM rn, board.* 
			from(select qna_keyword, qna_title, qna_content, qna_blindstate, qna_regdate	
				, qna_modifydate, qna_update_uno 
				from qna_board 
				where qna_blindstate=1 
					and (qna_title like '%'||#{qna_title}||'%'
						or qna_content like '%'||#{qna_content}||'%') 
				order by qna_bno) 
			board)
		 where rn between #{startRow} and #{endRow}
	</select>
</mapper>
